<?xml version="1.0" standalone="no"?>

<!--
SpagoBI - The Business Intelligence Free Platform

Copyright (C) 2005 Engineering Ingegneria Informatica S.p.A.

This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA



DESCRIPTION:
"spagonigeo.svg" is part of the SpagoBIGeoEngine. 
It is used to perform dynamic geo-analysis.


CREDITS:
* none so far



CURRENT VERSION: 
1.0.0

VERSION HISTORY:
* 1.0.0 (2007-09-17)
initial version

* 1.0.1 (2007-09-24)
changed the name of ub variable to ub_values in order to avoid naming conflict with slider.js
changed the name of lb variable to lb_values in order to avoid naming conflict with slider.js
bug fixed in layer's checkboxes generation

-->



<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
  "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">

<svg width="100%" height="100%" viewBox="0 0 1100 768" onload="init(evt);" 
xmlns:batik="http://xml.apache.org/batik/ext" 
xmlns:attrib="http://www.carto.net/attrib" 
xmlns:xlink="http://www.w3.org/1999/xlink" 
xmlns="http://www.w3.org/2000/svg"
xmlns:svg="http://www.w3.org/2000/svg" contentStyleType="text/css"    
xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
xmlns:dc="http://purl.org/dc/elements/1.1/"
xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
xmlns:cc="http://web.resource.org/cc/" sodipodi:version="0.32"
zoomAndPan="disable"
preserveAspectRatio="xMidYMin meet">

		<rect x="-3000" y="-500" width="10000" height="3000" stroke="none" fill="#e6e6e6"/>
		
		<g id="imported_scripts">
		
		</g>
		
		<script id="included_scripts" type="text/ecmascript"><![CDATA[
				
		]]></script>
		
		<script id="init" type="text/ecmascript"><![CDATA[
				
		]]></script>
		
		
		<script type="text/ecmascript"><![CDATA[
		
		
	   
	   
	   
				
		//global variables for mapApp and map object
		var myMapApp = new mapApp();
		var myMainMap;
		var radioGroup;
		var linkRadioGroup;
		var checkBoxes = new Array();
		
		var attribNS="http://www.carto.net/attrib";
		var xlinkNS = "http://www.w3.org/1999/xlink";
		var suspendProcess;
		var windowPositions = new Array();
			
		//var detailTabGroup;	
		
		var isShowTableModalityActive = true;
			
		function init() {
			window.setTimeout("initApplication()", 500);
		}
			
		
		function initWindows() {
			//create windows
			myMapApp.Windows = new Array();
			
			//first a few styles
			var winPlaceholderStyles = {"fill":"none","stroke":"dimgray","stroke-width":1.5};
			var windowStyles = {"fill":"#fffce6","stroke":"dimgray","stroke-width":1};
			var titlebarStyles = {"fill":"steelblue","stroke":"dimgray","stroke-width":1};
			var statusbarStyles = {"fill":"aliceblue","stroke":"dimgray","stroke-width":1};
			var titletextStyles = {"font-family":"Arial,Helvetica","font-size":14,"fill":"white"};
			var statustextStyles = {"font-family":"Arial,Helvetica","font-size":10,"fill":"dimgray"};
			var buttonStyles = {"fill":"steelblue","stroke":"white","stroke-width":2};
			var titlebarHeight = 17;
			var statusbarHeight = 13;
			
			// window instances creation
			myMapApp.Windows["navWindow"] = new Window("navWindow","Windows",210,200,10,491,true,8,8,1092,690,true,winPlaceholderStyles,windowStyles,3,true,false,"Navigation","",false,true,true,titlebarStyles,titlebarHeight,statusbarStyles,statusbarHeight,titletextStyles,statustextStyles,buttonStyles,windowHandling);
			myMapApp.Windows["navWindow"].appendContent("referenceMap",true);
			myMapApp.Windows["navWindow"].appendContent("zoomIn",true);
			myMapApp.Windows["navWindow"].appendContent("mapZoomSlider",true);
			myMapApp.Windows["navWindow"].appendContent("zoomOut",true);
			myMapApp.Windows["navWindow"].appendContent("zoomFull",true);
			myMapApp.Windows["navWindow"].appendContent("zoomManual",true);
			myMapApp.Windows["navWindow"].appendContent("panManual",true);
			myMapApp.Windows["navWindow"].appendContent("infoButton",true);
			myMapApp.Windows["navWindow"].appendContent("backwardExtent",true);
			myMapApp.Windows["navWindow"].appendContent("forwardExtent",true);
			myMapApp.Windows["navWindow"].minimize(true);
			
			myMapApp.Windows["basiclayer"] = new Window("basiclayer","Windows",210,200,436,491,true,8,8,1092,690,true,winPlaceholderStyles,windowStyles,3,true,false,"Map Layers","",false,true,true,titlebarStyles,titlebarHeight,statusbarStyles,statusbarHeight,titletextStyles,statustextStyles,buttonStyles,windowHandling);
			myMapApp.Windows["basiclayer"].appendContent("checkBoxes",true);
			myMapApp.Windows["basiclayer"].appendContent("linkRadioGroup",true);			
			myMapApp.Windows["basiclayer"].minimize(true);
			
			
			myMapApp.Windows["thematic"] = new Window("thematic","Windows",210,200,223,491,true,8,8,1092,690,true,winPlaceholderStyles,windowStyles,3,true,false,"Thematic Topics","",false,true,true,titlebarStyles,titlebarHeight,statusbarStyles,statusbarHeight,titletextStyles,statustextStyles,buttonStyles,windowHandling);
			myMapApp.Windows["thematic"].appendContent("radioButtons",true);
			myMapApp.Windows["thematic"].minimize(true);
			
			myMapApp.Windows["detail"] = new Window("detail","Windows",210,200,649,491,true,8,8,1092,690,true,winPlaceholderStyles,windowStyles,3,true,false,"Detail","",false,true,true,titlebarStyles,titlebarHeight,statusbarStyles,statusbarHeight,titletextStyles,statustextStyles,buttonStyles,windowHandling);
			myMapApp.Windows["detail"].appendContent("detailTabGroup",true);
			myMapApp.Windows["detail"].minimize(true);
			
			myMapApp.Windows["legend"] = new Window("legend","Windows",210,200,862,491,true,8,8,1092,690,true,winPlaceholderStyles,windowStyles,3,true,false,"Legend","",false,true,true,titlebarStyles,titlebarHeight,statusbarStyles,statusbarHeight,titletextStyles,statustextStyles,buttonStyles,windowHandling);
			myMapApp.Windows["legend"].appendContent("coulourboxes",true);
			myMapApp.Windows["legend"].minimize(true);
			
		}
		
		function closeAllWindows() {			
			myMapApp.Windows["navWindow"].close(true);					
			myMapApp.Windows["basiclayer"].close(true);		
			myMapApp.Windows["thematic"].close(true);			
			myMapApp.Windows["detail"].close(true);		
			myMapApp.Windows["legend"].close(true);
		}
		
		function initTabGroups() {
			
			//create tabGroups
			myMapApp.TabGroups = new Array();
			
			//first a few styles
			var tabStyles = {"fill":"rgb(180,180,180)","stroke":"dimgray","stroke-width":1,"cursor":"pointer"};
		    var tabwindowStyles = {"fill":"white","stroke":"dimgray","stroke-width":1};
		    var tabtextStyles = {"font-family":"Arial,Helvetica","font-size":15,"fill":"dimgray","font-weight":"normal"};
		    var tabtextStylesCenter = {"font-family":"Arial,Helvetica","font-size":15,"fill":"dimgray","font-weight":"normal","text-anchor":"middle"};
		                
		    //setting tabTitles
		    var tabTitles = new Array("Values","Chart");
		     
		    // tabGroup instances creation
		    myMapApp.TabGroups["detailTabGroup"] = new tabgroup("detailTabGroup","detailTabGroup",5,21,200,175,20,"round","round",5,0,tabStyles,"lightgray",tabwindowStyles,tabtextStyles,tabTitles,0,false,undefined);
		      		              
		    //add new content
		    myMapApp.TabGroups["detailTabGroup"].addContent("detailTabGroup__0_content",0,true);
		    myMapApp.TabGroups["detailTabGroup"].addContent("detailTabGroup__1_content",1,true);
		}
		
		function buttonClick(groupId,evt,buttonText) {
			if(buttonText == "Applay") {
				var colPicker = document.getElementById("colourPickerPanel_1");
				var values = myMapApp.colourPickers["colourPicker_1"].getValues();
				var colour = getRGB16(values);
				myMapApp.colArray[groupIndex-1] = colour;
				var rect = document.getElementById("rect" + groupIndex);
				rect.setAttribute("fill", colour);
				colourMap();            		
			} else if(buttonText == "Ok") {
				var colPicker = document.getElementById("colourPickerPanel_1");
				var values = myMapApp.colourPickers["colourPicker_1"].getValues();
				var colour = getRGB16(values);
				myMapApp.colArray[groupIndex-1] = colour;
				var rect = document.getElementById("rect" + groupIndex);
				rect.setAttribute("fill", colour);
				colPicker.setAttribute("display", "none");
				colourMap();           		
			} else if(buttonText == "Cancel") {
				var colPicker = document.getElementById("colourPickerPanel_1");
				var values = myMapApp.colourPickers["colourPicker_1"].getValues();
				var colour = getRGB16(values);
				myMapApp.colArray[groupIndex-1] = groupColourBkp;
				var rect = document.getElementById("rect" + groupIndex);
				rect.setAttribute("fill", groupColourBkp);
				colPicker.setAttribute("display", "none");
				colourMap(); 
			}
		}
		
		function getRGB16(values) {
			var red = values.fill.red.toString(16);
			if(red.length == 1) red = "0" + red;
			var green = values.fill.green.toString(16);
			if(green.length == 1) green = "0" + green;
			var blue = values.fill.blue.toString(16);
			if(blue.length == 1) blue = "0" + blue;
			var colour = "#" + red + green + blue;
			return colour;
		}
		
		var groupIndex = 0;
		var groupColourBkp = 0;
		
		function openColourPiker(evt) {
		   var el = evt.target;
           var id = el.getAttribute("id");
           var fill = el.getAttribute("fill");
           
           groupIndex = parseInt(id.substring(4));
           groupColourBkp = myMapApp.colArray[groupIndex-1];
           
           var rgb16 = new Array();
           var rgb10 = new Array();
           
           rgb16["red"] = fill.substring(1,3);
           rgb16["green"] = fill.substring(3,5);
           rgb16["blue"] = fill.substring(5);
           
           rgb10["red"] = parseInt(rgb16["red"],16);
           rgb10["green"] = parseInt(rgb16["green"],16);
           rgb10["blue"] = parseInt(rgb16["blue"],16);
           
           
           
           /*
           myMapApp.colourPickers["colourPicker_1"].rgbArr["fill"]["red"] = rgb10["red"];
           myMapApp.colourPickers["colourPicker_1"].rgbArr["fill"]["green"] = rgb10["green"];
           myMapApp.colourPickers["colourPicker_1"].rgbArr["fill"]["blue"] = rgb10["blue"];
           myMapApp.colourPickers["colourPicker_1"].rebuild();
           */
           
           var colPicker = document.getElementById("colourPickerPanel_1");
           colPicker.setAttribute("display", "inherit");
           
           myMapApp.colourPickers["colourPicker_1"].setRGBAColour("fill",rgb10["red"],rgb10["green"], rgb10["blue"],1, true);
           /*
           
           myMapApp.colourPickers["colourPicker_1"].fillStartColors = [255,0,0,1];
           myMapApp.colourPickers["colourPicker_1"].rebuild();
           */
           //myMapApp.colourPickers["colourPicker_1"].setRGBAColour("fill",10,120, 0,1, myMapApp.colourPickers["colourPicker_1"].fireFunction);           
		}
		
		function initButtons() {
			// create buttons
			myMapApp.buttons = new Array();
			
			//first a few styles
			var buttonTextStyles = {"font-family":"Arial,Helvetica","fill":"dimgray","font-size":10};
			var buttonStyles = {"fill":"white"};
			var shadeLightStyles = {"fill":"rgb(235,235,235)"};
			var shadeDarkStyles = {"fill":"dimgray"};
			
			//button instances creation
			
			myMapApp.buttons["zoomIn"] = new button("zoomIn",zoomImageButtons,"rect",undefined,"magnifyerZoomIn",7,165,20,20,buttonTextStyles,buttonStyles,shadeLightStyles,shadeDarkStyles,1);
			myMapApp.buttons["zoomOut"] = new button("zoomOut",zoomImageButtons,"rect",undefined,"magnifyerZoomOut",32,165,20,20,buttonTextStyles,buttonStyles,shadeLightStyles,shadeDarkStyles,1);
			myMapApp.buttons["infoButton"] = new switchbutton("infoButton",zoomImageSwitchButtons,"rect",undefined,"infoBut",132,165,20,20,buttonTextStyles,buttonStyles,shadeLightStyles,shadeDarkStyles,1);
			myMapApp.buttons["infoButton"].setSwitchValue(true,false);
			statusChange("Mode: Infomode");
			myMapApp.buttons["zoomFull"] = new button("zoomFull",zoomImageButtons,"rect",undefined,"magnifyerFull",57,165,20,20,buttonTextStyles,buttonStyles,shadeLightStyles,shadeDarkStyles,1);
			myMapApp.buttons["zoomManual"] = new switchbutton("zoomManual",zoomImageSwitchButtons,"rect",undefined,"magnifyerManual",82,165,20,20,buttonTextStyles,buttonStyles,shadeLightStyles,shadeDarkStyles,1);
			myMapApp.buttons["panManual"] = new switchbutton("panManual",zoomImageSwitchButtons,"rect",undefined,"symbPan",107,165,20,20,buttonTextStyles,buttonStyles,shadeLightStyles,shadeDarkStyles,1);
			myMapApp.buttons["recenterMap"] = new switchbutton("recenterMap",zoomImageSwitchButtons,"rect",undefined,"symbRecenter",132,165,20,20,buttonTextStyles,buttonStyles,shadeLightStyles,shadeDarkStyles,1);
			myMapApp.buttons["backwardExtent"] = new button("backwardExtent",zoomImageButtons,"rect",undefined,"symbArrowLeft",157,165,20,20,buttonTextStyles,buttonStyles,shadeLightStyles,shadeDarkStyles,1);
			myMapApp.buttons["forwardExtent"] = new button("forwardExtent",zoomImageButtons,"rect",undefined,"symbArrowRight",182,165,20,20,buttonTextStyles,buttonStyles,shadeLightStyles,shadeDarkStyles,1);
			
			
			myMapApp.buttons["okbutton"] = new button("colourPickerApplay",buttonClick,"rect","Applay", undefined, 380, 425, 40,25,buttonTextStyles,buttonStyles,shadeLightStyles,shadeDarkStyles,1);
			myMapApp.buttons["okbutton"] = new button("colourPickerOk",buttonClick,"rect","Ok", undefined, 430, 425, 40,25,buttonTextStyles,buttonStyles,shadeLightStyles,shadeDarkStyles,1);
			myMapApp.buttons["okbutton"] = new button("colourPickerCancel",buttonClick,"rect","Cancel", undefined, 480,425,40,25,buttonTextStyles,buttonStyles,shadeLightStyles,shadeDarkStyles,1);
			
		
		
			//see if we need to disable buttons
			myMainMap.checkButtons();
		}
		
		function intCheckBoxes() {
		
			//create checkboxes array
			myMapApp.checkBoxes = new Array();
			
			//first a few styles
			var labeltextStyles = {"font-family":"Arial,Helvetica","fill":"dimgray","font-size":14};
						
			//create  checkboxe instances
			
			// layers checkboxes
			var offset;
			for(i = 0; i < layer_names.length; i++) {
				offset = 45 + (30*i);
				var mapLayer = document.getElementById(layer_names[i]);
				//alert(layer_names[i] + " element -> " + mapLayer);
				var displayStatus = mapLayer.getAttributeNS(null,"display");
				var checked = true;
				if(displayStatus == "none") checked = false;
				//alert(layer_names[i] + " checked -> " + checked + " - " + displayStatus);
				myMapApp.checkBoxes[layer_names[i]] = new checkBox("cb_" + layer_names[i],"checkBoxes",30,offset,"checkBoxRect","checkBoxCross",checked,layer_descriptions[i],labeltextStyles,12,undefined,toggleMapLayer);
			}

			
			// Navigation radio buttons
			linkRadioGroup= new radioButtonGroup("linkRadioGroup", setLinkAction);
			myMapApp.checkBoxes['cross_nav'] = new checkBox("cross_nav","linkRadioGroup",30,offset+40,"radioBorder","radioPoint",false, "Cross Nav.",labeltextStyles,12,linkRadioGroup,undefined);
			myMapApp.checkBoxes['drill_nav'] = new checkBox("drill_nav","linkRadioGroup",30,offset+60,"radioBorder","radioPoint",false, "Drill Nav.",labeltextStyles,12,linkRadioGroup,undefined);
		
			// Thematic radio buttons
			radioGroup= new radioButtonGroup("radioButtons",setKpi);
			//the following two checkboxes are added to the radio button group stored in the object instance 'radioGroupQuality'
			for(i = 0; i < kpi_names.length; i++) {
				offset = 50 + (30*i);
				myMapApp.checkBoxes[kpi_names[i]] = new checkBox(kpi_names[i],"radioButtons",30,offset,"radioBorder","radioPoint",false,kpi_descriptions[i],labeltextStyles,12,radioGroup,undefined);
			}
			
			//load function specific to the current map project
			radioGroup.selectById(kpi_names[selected_kpi_index],true);
			//linkRadioGroup.selectById("drill_nav");
			//linkRadioGroup.selectById("cross_nav");
			if (defaultDrillNav == true){
				//setLinkAction("linkRadioGroup", "drill_nav", "Drill Nav.");
				linkRadioGroup.selectById("drill_nav");
				//alert("drill_nav");
			}
			else{
				//setLinkAction("linkRadioGroup", "cross_nav", "Cross Nav.");
				linkRadioGroup.selectById("cross_nav");
				//alert("cross_nav");
			}
			
			
		}
		
		function initDetailInfopanels() {
			// create detail infopanels
			myMapApp.infoPanel = new Array();
			var dynamText = document.getElementById("dynamText");
			for(i = 0; i < kpi_names.length; i++) {
				var offset = 50 + (i*25);
				var panel = document.createElementNS(svgNS,"text");
				panel.setAttribute("id","infopanel" + (i+1));
				panel.setAttribute("x", "20");
				panel.setAttribute("y", "" + offset);
				panel.setAttribute("fill", "dimgray");
				panel.setAttribute("font-family", "Arial,Helvetica");
				panel.setAttribute("font-size", "14px");
				panel.setAttribute("startOffset", "0");
				
				var text_node = document.createTextNode(kpi_descriptions[i]);
				panel.appendChild(text_node);
				
				dynamText.appendChild(panel);
				
				myMapApp.infoPanel[i] = panel;
			}
		}
		
		function initLegendEntries() {
			// create legendpanels & legendrect
			myMapApp.legPanel = new Array();	
			myMapApp.legRect = new Array();
			var coulourBoxes = document.getElementById("coulourboxes");			
			for(i = 0; i < 5; i++) {
				// ...legendpanel
				var offset = 50 + (i*25);
				var panel = document.createElementNS(svgNS,"text");
				panel.setAttribute("id","legpanel" + (i+1));
				panel.setAttribute("x", "70");
				panel.setAttribute("y", "" + offset);
				panel.setAttribute("fill", "dimgray");
				panel.setAttribute("font-family", "Arial,Helvetica");
				panel.setAttribute("font-size", "14px");
				panel.setAttribute("startOffset", "0");
				
				var text_node = document.createTextNode("legpanel-" + (i+1));
				panel.appendChild(text_node);
				
				coulourBoxes.appendChild(panel);
				
				myMapApp.legPanel[i] = panel;
				
				// ...legendrect
				var offset = 35 + (i*25);
				var rect = document.createElementNS(svgNS,"rect");
				rect.setAttribute("id","rect" + (i+1));
				rect.setAttribute("stroke","dimgray");
				rect.setAttribute("x","30");
				rect.setAttribute("y",offset);
				rect.setAttribute("width","30");
				rect.setAttribute("height","50");
				rect.setAttribute("fill","#500000");
				rect.setAttribute("onclick","openColourPiker(evt)");
				
				coulourBoxes.appendChild(rect);
				
				myMapApp.legRect[i] = rect;
			}	
		}
		
		function initColourPikers() {
			// Create colour pickers
			myMapApp.colourPickers = new Array();
			
			// Colour picker styles
			var cpBgStyles = {"fill":"gainsboro"};
			var cpBgStyles = {"fill":"white","stroke":"dimgray","stroke-width":1};
			var cpTextStyles = {"font-family":"Arial,Helvetica","font-size":12,"fill":"dimgray"};
			
			myMapApp.colourPickers["colourPicker_1"]  = 
				new colourPicker("colourPicker_1", //the id of the colour picker
								 "colourPickerBox_1", //the id or node reference of the parent group where the button can be appended
								 300,300, //upper left corner of colour picker
								 300,120, //width & height of colour picker
								 cpBgStyles,
								 cpTextStyles,
								 "sliderSymbol", //id referencing the slider symbol to be used for the sliders
								 true, // satSliderVisible
								 true, // valSliderVisible
								 false, // alphaSliderVisible
								 true, // colValTextVisible
								 true, // fillVisible
								 false, // strokeVisible
								 0, 360, // start & end hue in degree (0 to 360)
								 7, //nr of stop vals in between, in addition to start and end
								 "255,0,0,1", // fillStartColor: string, rgba.format, f.e. 255,0,0,1
								 "0,0,0,0.7", // strokeStartColorstring, rgba.format, f.e. 255,0,0,1
								 undefined);
		}
		
		function initSliders() {
			//create zoom slider	
			//function slider(id,parentNode,x1,y1,value1,x2,y2,value2,startVal,sliderStyles,invisSliderWidth,sliderSymb,functionToCall,mouseMoveBool) {
			//function slider(x1,y1,value1,x2,y2,value2,startVal,sliderGroupId,sliderColor,visSliderWidth,invisSliderWidth,sliderSymb,functionToCall,mouseMoveBool) {
	
			//myMapApp.zoomSlider = new slider(180,153,myMainMap.minWidth,20,153,myMainMap.maxWidth,myMainMap.maxWidth, "mapZoomSlider","dimgray",2,10,"sliderSymbol",myMapApp.refMapDragger,true);
			
			var sliderStyles = {"stroke":"dimgray","stroke-width":"2","fill":"dimgray"};
					
			
			myMapApp.zoomSlider = new slider("zoomSliderId", 
											 "mapZoomSlider", 
											 180,153,
											 myMainMap.minWidth,
											 20,153,
											 myMainMap.maxWidth,
											 myMainMap.maxWidth,
											 sliderStyles, 
											 15,
											 "sliderSymbol",
											 myMapApp.refMapDragger,			
										     true);
		}
			
		function initApplication(evt) {			
			if (document.documentElement.suspendRedraw) {
				suspendProcess = document.documentElement.suspendRedraw(30000);
			}
		
			
			setTresholds();
			setColourRange();
			
			initMainMap();			
			initWindows();
			if(activeWindow == false) {
				closeAllWindows();
			}
			initTabGroups();
			initButtons();
			initSliders();		      			
			intCheckBoxes();
			initDetailInfopanels();
			initLegendEntries();			
			initColourPikers();
			
			myMapApp.loadStatus = document.getElementById("statusColorMap");
			myMapApp.loadStatus = document.getElementById("statusColorMap");
			myMapApp.targetLayer = document.getElementById(layer_names[target_layer_index]);
			
			loadProjectSpecific();
			
			if (document.documentElement.suspendRedraw) {
				document.documentElement.unsuspendRedraw(suspendProcess);
			}
		}
		
		
		
		
		
		
	   //this function is called after each pan or zoom or change of map extent
       //you can place project specific functions here that need to re.on the map extent, e.g. adopting line-widths, loading additional data, etc.
       function loadProjectSpecific() {
           var names = [];
           var values = [];
           var maxValue = 0;
           var child = myMapApp.targetLayer.firstChild;
           while(child) {
           	   var targetNode = child;	
               if(targetNode.nodeName == "a") {
               		targetNode = targetNode.firstChild;
               }
               
               if (targetNode.nodeName == "path") {
                   for(i = 0; i < kpi_names.length; i++) {
                       var t = parseFloat(targetNode.getAttributeNS(attribNS, kpi_names[i]));
                       if(t > maxValue) {
                           maxValue = t;
                       }
                   }
               }
               child = child.nextSibling;
           }     
          					
                                               
           var detailBarChartRenderer = new BarChartRenderer(50, 35,100,100,3);
           detailBarChartRenderer.maxGridLineValue = maxValue;
           var layerBarChartRenderer = new BarChartRenderer(50, 35,100,100,3);
           layerBarChartRenderer.maxGridLineValue = maxValue;
           layerBarChartRenderer.gridLineVisible = false;
           layerBarChartRenderer.labelsVisible = false;
           child = myMapApp.targetLayer.firstChild;
           while(child) {
           
               var targetNode = child;	
               if(targetNode.nodeName == "a") {
	               	var crossUrl = targetNode.getAttributeNS(xlinkNS, "href");
					var drillUrl = "../servlet/AdapterHTTP?ACTION_NAME=SHOW_DATA_DETAILS_ACTION";
					var featureValue = targetNode.firstChild.getAttribute("id");
					drillUrl += "&featureValue=" + featureValue;
					targetNode.setAttributeNS(attribNS, "crossUrl", crossUrl);
					targetNode.setAttributeNS(attribNS, "drillUrl", drillUrl);
					if (defaultDrillNav == true){
						targetNode.setAttributeNS(xlinkNS, "href", drillUrl);
					} else {
						targetNode.setAttributeNS(xlinkNS, "href", crossUrl);
					}
	               	targetNode = targetNode.firstChild;
               }
			   
               if (targetNode.nodeName == "path") {
                   names = new Array();
                   values = new Array();
                                     for(i = 0; i < kpi_names.length; i++) {
                       names[i] = kpi_names[i];
                       values[i] = targetNode.getAttributeNS(attribNS, kpi_names[i]);
                   }
                                     detailBarChartRenderer.setDataset(names, values, kpi_colours);
                   detailBarChartRenderer.render(document.getElementById("detailTabGroup__1_content"), targetNode.getAttributeNS(null, "id") + "_chart", "none");
                   if(includeChartLayer == true) {
                       layerBarChartRenderer.setDataset(names, values, kpi_colours);
                       var chartW = 800;
                       var chartH = 1600;
                       var centroide = document.getElementById("centroidi_" + targetNode.getAttributeNS(null, "id"));
                       if(centroide != null) {
                       	   layerBarChartRenderer.chartX = centroide.getAttributeNS(null, "cx") - (chartW/2);
	                       layerBarChartRenderer.chartY = centroide.getAttributeNS(null, "cy") - (chartH);
	                       layerBarChartRenderer.chartW = chartW;
	                       layerBarChartRenderer.chartH = chartH;
	                       layerBarChartRenderer.render(document.getElementById("grafici"), targetNode.getAttributeNS(null, "id") + "_chartLayer", "inherit");
                   	   } else {
                   	   	//alert("Nessun centroide per " + targetNode.getAttributeNS(null, "id") + "!!!");
                   	   }
                   }
                   
                   if(includeValuesLayer == true) {
                       var text;
                       
                       var rounded_value = values[selected_kpi_index];
                   	   var value_string = rounded_value.toString();
		   			   var decimal_location = value_string.indexOf(".");		
		   			   if (decimal_location != -1) {
                   	   		var value_float = round_decimals( parseFloat(value_string), 2 );
                   	   		text = value_float.toString();
                   	   } else {                       	
                       		text = values[selected_kpi_index];
                  	   }
                       
                       
                       var valueLabel = document.createElementNS(svgNS,"text");
                       var centroide = document.getElementById("centroidi_" + targetNode.getAttributeNS(null, "id"));
                       if(centroide != null) {
	                       valueLabel.setAttribute("x",centroide.getAttributeNS(null, "cx"));
	                       valueLabel.setAttribute("y",centroide.getAttributeNS(null, "cy"));
	                       valueLabel.setAttribute("id", "label_" + targetNode.getAttributeNS(null, "id"));
	                       valueLabel.setAttribute("text-anchor","middle");
	                       valueLabel.setAttribute("font-family","Arial,Helvetica");
	                       valueLabel.setAttribute("font-size","600px");
	                       valueLabel.setAttribute("fill","black");
	                       var textNode = document.createTextNode(text);
	                       valueLabel.appendChild(textNode);
	                       var valuesLayer = document.getElementById("valori");
	                       valuesLayer.appendChild(valueLabel);
	                    } else {
	                    	//alert("Nessun centroide per " + targetNode.getAttributeNS(null, "id") + "!!!");
	                    }
                   }
               }
               child = child.nextSibling;
           }
       } 
		
	  
		function initMainMap() {
			//dynamic layer array that allow loading from database
			var dynamicLayers = new Array();
			
			//initialize digiLayers (layers that allow digitizing)
			var digiLayers = new Array();
			
			//define some styles for the map object
			var zoomRectStyles = {"fill":"none","stroke":"crimson","stroke-width":0.002,"stroke-dasharray":"0.012,0.002"};
			var highlightStyles = {"stroke":"crimson","stroke-width":0.002};
			var dragRectStyles = {"fill":"dimgray","fill-opacity":0.3};
						
			//initialize myMainMap object, you need to adopt the parameters here
			myMainMap = new map("mainMap",35910,35,0.6,0,26911,"m",1,false,"","",dynamicLayers,digiLayers,"",zoomRectStyles,highlightStyles,dragRectStyles,"referenceMap","myDragCrossSymbol",4750);
		}
		
		
		
		function setColourRange() {
			for(i = 0; i < kpi_names.length; i++) {	
				if(colorRangeCalculationType[kpi_names[i]] == "gradient") {
					setGradientColourRange(kpi_names[i]);
				} else if (colorRangeCalculationType[kpi_names[i]] == "static") {
					// do nothing
				} else {
					setGradientColourRange(kpi_names[i]);
				}
			}
		}
		
		function setGradientColourRange(kpiName) { 
			var A = new Array();
			var Grad = new Array();
			var new_rA;
			var new_gA;
			var new_bA;
			var shade;
			
			// splitting color components, conversion to decimal, and storing in array
			A["r"] = parseInt(colorRangeCalculationGradParams[kpiName].substring(1,3),16);
			A["g"] = parseInt(colorRangeCalculationGradParams[kpiName].substring(3,5),16);
			A["b"] = parseInt(colorRangeCalculationGradParams[kpiName].substring(5),16);
			RGB = [A["r"],A["g"],A["b"]].sort(function(a,b) {return parseInt(a) - parseInt(b)}); 
			for(comp in A) {
				if(A[comp] == RGB[2]) Grad[comp] = parseInt((240 - A[comp]) / (num_group[kpiName] - 1));	
				else if(A[comp] == RGB[1]) Grad[comp] = parseInt((230 - A[comp]) / (num_group[kpiName] - 1));
				else  Grad[comp] = parseInt((220 - A[comp]) / (num_group[kpiName] - 1));
			}
			
			eval("col_"+kpiName+"=new Array()");
		    var colorRangeArray = eval("col_"+kpiName);
		    colorRangeArray[0] = colorRangeCalculationGradParams[kpiName];
		   
		    
			for(var j = 1; j < num_group[kpiName]; j++) {
				new_rA = A["r"] + Grad["r"] * j;
				new_gA = A["g"] + Grad["g"] * j;
				new_bA = A["b"] + Grad["b"] * j;
				//alert(new_rA + " " + new_gA + " " + new_bA);
				shade = "#" + new_rA.toString(16) + new_gA.toString(16) + new_bA.toString(16);	
				colorRangeArray[j] = shade;		
			}
			colorRangeArray.reverse();
			
			//alert(kpiName + " - " + colorRangeArray);	
		}
		
		
		
		
		
	   function setTresholds() {	   		
	   
	   		//alert('setTresholds');
			for(i = 0; i < kpi_names.length; i++) {					
				
				if(lb_values[kpi_names[i]] == null) {
		   			lb_values[kpi_names[i]] = kpi_ordered_values[kpi_names[i]][0];
		   		}
		   		if(ub_values[kpi_names[i]] == null) {
		   			ub_values[kpi_names[i]] = kpi_ordered_values[kpi_names[i]][kpi_ordered_values[kpi_names[i]].length-1];
		   		}
		   		
		   		if(lb_values[kpi_names[i]] > ub_values[kpi_names[i]]) {
		   			var t = lb_values[kpi_names[i]];
		   			ub_values[kpi_names[i]] = lb_values[kpi_names[i]];
		   			lb_values[kpi_names[i]] = t;
		   		}
		   		
		   		if(ub_values[kpi_names[i]] < kpi_ordered_values[kpi_names[i]][0] || lb_values[kpi_names[i]] >  kpi_ordered_values[kpi_names[i]][kpi_ordered_values[kpi_names[i]].length-1]) {
		   			lb_values[kpi_names[i]] = kpi_ordered_values[kpi_names[i]][0];
		   			ub_values[kpi_names[i]] = kpi_ordered_values[kpi_names[i]][kpi_ordered_values[kpi_names[i]].length-1];
		   		}
				
				
				
				if(trasholdCalculationType[kpi_names[i]] == "quantile") {
					setQuantileTrasholds(kpi_names[i]);
				} else if (trasholdCalculationType[kpi_names[i]] == "perc") {
					setPercTrasholds(kpi_names[i]);
				} else if (trasholdCalculationType[kpi_names[i]] == "uniform") {
					setUniformTrasholds(kpi_names[i]);
				} else if (trasholdCalculationType[kpi_names[i]] == "static") {
					num_group[kpi_names[i]] = eval("thresh_"+kpi_names[i]+".length-1");
				} else {
					setQuantileTrasholds(kpi_names[i]);
				}
				
				
				
			}
		}
		
		function setPercTrasholds(kpiName) { 
			var range = ub_values[kpiName] - lb_values[kpiName];
			
			eval("thresh_"+kpiName+"=new Array()");
		    var trasholds = eval("thresh_"+kpiName);
		    trasholds[0] = lb_values[kpiName];
		   
			for(var j = 0; j < trasholdCalculationPercParams[kpiName].length-1; j++) {
				var groupSize = (range / 100.0) * trasholdCalculationPercParams[kpiName][j];
				trasholds[j+1] = trasholds[j] + groupSize;
			}
			
			trasholds[trasholdCalculationPercParams[kpiName].length] = ub_values[kpiName];	
			
			num_group[kpiName] = trasholdCalculationPercParams[kpiName].length;
		}
		
		function setUniformTrasholds(kpiName) { 
			trasholdCalculationPercParams[kpiName] = new Array();
			var perc = 100 / trasholdCalculationUniformParams[kpiName];
			for(var j = 0; j < trasholdCalculationUniformParams[kpiName]; j++) {
				trasholdCalculationPercParams[kpiName][j] = perc;
			}
			setPercTrasholds(kpiName);
		}
		
		function setQuantileTrasholds(kpiName) {
				
				/*
				if(lb_values[kpiName] == null) {
		   			lb_values[kpiName] = kpi_ordered_values[kpiName][0];
		   		}
		   		if(ub_values[kpiName] == null) {
		   			ub_values[kpiName] = kpi_ordered_values[kpiName][kpi_ordered_values[kpi_name].length-1];
		   		}
		   		
		   		if(lb_values[kpiName] > ub_values[kpiName]) {
		   			var t = lb_values[kpiName];
		   			ub_values[kpiName] = lb_values[kpiName];
		   			lb_values[kpiName] = t;
		   		}
		   		
		   		if(ub_values[kpiName] < kpi_ordered_values[kpiName][0] || lb_values[kpiName] >  kpi_ordered_values[kpiName][kpi_ordered_values[kpiName].length-1]) {
		   			lb_values[kpiName] = kpi_ordered_values[kpiName][0];
		   			ub_values[kpiName] = kpi_ordered_values[kpiName][kpi_ordered_values[kpiName].length-1];
		   		}
		   		*/
				
				eval("thresh_"+kpiName+"=new Array()");
				var trasholds = eval("thresh_"+kpiName);
				
				var diff_value_num = 0;	
				var start_index = -1;	
				if(kpi_ordered_values[kpiName][0] >= lb_values[kpiName] && kpi_ordered_values[kpiName][kpi_ordered_values[kpiName].length-1] <= ub_values[kpiName]) {
					diff_value_num = kpi_ordered_values[kpiName].length;
					start_index = 0;
				} else {
					for(j = 0; j < kpi_ordered_values[kpiName].length; j++) {						
			   			if(kpi_ordered_values[kpiName][j] >= lb_values[kpiName] && kpi_ordered_values[kpiName][j] <= ub_values[kpiName]) {
			   				start_index = (start_index == -1?j:start_index);
			   				diff_value_num++;
			   			}
		   			}
		   		}
		   		
		   		
				if(diff_value_num < num_group[kpiName]) num_group[kpiName] = diff_value_num;
				var blockSize = Math.floor( diff_value_num / num_group[kpiName] );
			
				trasholds[0] = lb_values[kpiName];
				for(j = 1; j < num_group[kpiName] ; j++){
					trasholds[j] = kpi_ordered_values[kpiName][start_index + (j*blockSize)];
				}
				trasholds[num_group[kpiName]] = ub_values[kpiName];
		}
		
			
		//this function toggles the display attribute of a map layer
		function toggleMapLayer(id,checkStatus,labelText) {
			var layerId = id.replace(/cb_/, "");
			var mapLayer = document.getElementById(layerId);
			var displayStatus = "none";
			if (checkStatus) {
				displayStatus = "inherit";
			}
			mapLayer.setAttributeNS(null,"display",displayStatus);
		}
		
		
		
		function setKpi(cbId,radioId,label) {
			if (document.documentElement.suspendRedraw) {
				suspendProcess = document.documentElement.suspendRedraw(30000);
			}
			//set current topic in mapApp object
			myMapApp.curKpi = radioId;
			myMapApp.colArray = eval("col_"+myMapApp.curKpi);
			myMapApp.threshArray = eval("thresh_"+myMapApp.curKpi);
			myMapApp.curLabel = label;
			
			var coulourBoxes = document.getElementById("coulourboxes");			
			for(i = 0; i < myMapApp.legRect.length; i++) {
				coulourBoxes.removeChild(myMapApp.legRect[i]);
				coulourBoxes.removeChild(myMapApp.legPanel[i]);
			}
			
			
			
			myMapApp.legPanel = new Array();	
			myMapApp.legRect = new Array();		
			for(i = 0; i < num_group[myMapApp.curKpi]; i++) {
				// ...legendpanel
				var offset = 50 + (i*25);
				var panel = document.createElementNS(svgNS,"text");
				panel.setAttribute("id","legpanel" + (i+1));
				panel.setAttribute("x", "70");
				panel.setAttribute("y", "" + offset);
				panel.setAttribute("fill", "dimgray");
				panel.setAttribute("font-family", "Arial,Helvetica");
				panel.setAttribute("font-size", "14px");
				panel.setAttribute("startOffset", "0");
				var closingChar = (i!=num_group[myMapApp.curKpi]-1?")":"]");
				var textString = "-   [" + number_to_string(myMapApp.threshArray[i],2) + " - " + number_to_string(myMapApp.threshArray[i+1],2) + closingChar;
				var text_node = document.createTextNode(textString);
				panel.appendChild(text_node);
				
				coulourBoxes.appendChild(panel);
				
				myMapApp.legPanel[i] = panel;
				
				// ...legendrect
				var offset = 35 + (i*25);
				var rect = document.createElementNS(svgNS,"rect");
				rect.setAttribute("id","rect" + (i+1));
				rect.setAttribute("stroke","dimgray");
				rect.setAttribute("x","30");
				rect.setAttribute("y",offset);
				rect.setAttribute("width","30");
				rect.setAttribute("height","20");
				rect.setAttribute("fill",myMapApp.colArray[i]);
				rect.setAttribute("onclick", "openColourPiker(evt)");
				rect.setAttribute("cursor", "pointer");
				
				coulourBoxes.appendChild(rect);
				
				myMapApp.legRect[i] = rect;
			}	
			
			
			myMapApp.loadStatus.setAttributeNS(null,"display","inline");		
			
			window.setTimeout("colourMap()",200);
			if (document.documentElement.suspendRedraw) {
				document.documentElement.unsuspendRedraw(suspendProcess);
			}
		}
			
			
		function mouseClickHandler(evt) {
			var targetElemet = evt.target;
			
			alert(evt.type);
			
			/*
			if(isShowTableModalityActive) {
				var parameters = new Array();
         		parameters[0] = targetElemet.getAttribute("id");
         		top.executeFunctionInChildFrame(0, "showTable", parameters);
				
				
				//alert("bella di padella: " + targetElemet.getAttribute("id"));
				//parent.showTable(targetElemet.getAttribute("id"));				
			} else {
				alert("Sorry, drill modality is not fully sopported yet");
			}
			*/
		}	
		
		function setLinkAction(cbId,radioId,label) {
			var child = myMapApp.targetLayer.firstChild;
		 	
			while(child) {
			
				var targetNode = child;					
				if (targetNode.nodeName == "a") {
					var url;
					if(radioId == "drill_nav") {
						url = targetNode.getAttributeNS(attribNS, "drillUrl");
					} else {
						url = targetNode.getAttributeNS(attribNS, "crossUrl");
					}						
					targetNode.setAttributeNS(xlinkNS, "href", url);
				}
				child = child.nextSibling;
			}
		}
		
		function round_decimals(original_number, decimals) {
		   var result1 = original_number * Math.pow(10, decimals);
		   var result2 = Math.round(result1);
		   var result3 = result2 / Math.pow(10, decimals);
		   return pad_with_zeros(result3, decimals);
		}
			
		function pad_with_zeros(rounded_value, decimal_places) {
		
		   // Convert the number to a string
		   var value_string = rounded_value.toString();
		   
		   // Locate the decimal point
		   var decimal_location = value_string.indexOf(".");
		
		   // Is there a decimal point?
		   if (decimal_location == -1) {
		       // If no, then all decimal places will be padded with 0s
		       decimal_part_length = 0;
		       // If decimal_places is greater than zero, tack on a decimal point
		       value_string += decimal_places > 0 ? "." : "";
		   } else {		
		       // If yes, then only the extra decimal places will be padded with 0s
		       decimal_part_length = value_string.length - decimal_location - 1;
		   }
		   
		   // Calculate the number of decimal places that need to be padded with 0s
		   var pad_total = decimal_places - decimal_part_length;
		   if (pad_total > 0) {
		   		// Pad the string with 0s
		   		for (var counter = 1; counter <= pad_total; counter++) value_string += "0";
		   }
		   return value_string;
		}
		
		function number_to_string(rounded_value, decimals) {
			var result = null;
			var value_string = rounded_value.toString();
		   	var decimal_location = value_string.indexOf(".");		
		    if (decimal_location != -1) {
                var value_float = parseFloat(value_string);
            	result = round_decimals(value_float, decimals);
             } else {                       	
                result = value_string;
             }
             
             return result;
		}

        function showData(evt){
           var el = evt.target;
           var nome = el.getAttributeNS(attribNS,"nome");
           if(nome == null || nome == "") nome = el.getAttribute("id");
           
           var id = el.getAttributeNS(null,"id");
           var kpi_values = [];
           
           for(i = 0; i < kpi_names.length; i++) {
                   kpi_values[kpi_names[i]] = el.getAttributeNS(attribNS,kpi_names[i]);
           }
           
           var targetValue = parseFloat(kpi_values[myMapApp.curKpi]);
           
           //determine class
           var colIndex = -1;   
           
           if(targetValue ==  myMapApp.threshArray[myMapApp.threshArray.length-1] ) {
           		colIndex = myMapApp.threshArray.length-2;
           } else {             
	           for (var i = 0;i<myMapApp.threshArray.length-1;i++) {
	               if (targetValue >= myMapApp.threshArray[i] && targetValue <  myMapApp.threshArray[i+1]) {
	                   colIndex = i;
	                   break;
	               }
	           }
	       }
           
           var curLegendRect = (colIndex != -1? eval("myMapApp.legRect[" + colIndex + "]") : null);
           
           if (evt.type=="mouseover"){
               myMapApp.Windows["detail"].setTitleText(nome);
               if (!myMapApp.Windows["detail"].closed) {
                   for(i = 0; i < kpi_names.length; i++) {
                        var rounded_value = kpi_values[kpi_names[i]];
                   		var value_string = rounded_value.toString();
		   				var decimal_location = value_string.indexOf(".");		
		   				if (decimal_location != -1) {
                   	   		var value_float = parseFloat(kpi_values[kpi_names[i]]);
                   	   		myMapApp.infoPanel[i].firstChild.nodeValue = kpi_descriptions[i] + " " + round_decimals(value_float,2);
                   	   	} else {                       	
                       		myMapApp.infoPanel[i].firstChild.nodeValue = kpi_descriptions[i] + " " + kpi_values[kpi_names[i]];
                  		}
				   }
                   if(document.getElementById(id + "_chart") != null) {
                   		document.getElementById(id + "_chart").setAttributeNS(null, "display","block");
                   }
                }
                             
                myMapApp.Windows["legend"].setTitleText(myMapApp.curKpi + ": " + round_decimals(targetValue,2));
               	if (curLegendRect != null && !myMapApp.Windows["legend"].closed) {
                   curLegendRect.setAttributeNS(null, "stroke-width",2);
                   curLegendRect.setAttributeNS(null, "stroke","black");
               	}
            }
                     
            if (evt.type=="mouseout"){
               myMapApp.Windows["detail"].setTitleText("Detail");
               if (!myMapApp.Windows["detail"].closed) {
                   for(i = 0; i < kpi_names.length; i++) {
                       myMapApp.infoPanel[i].firstChild.nodeValue = kpi_descriptions[i] + " ";
                   }
                   if(document.getElementById(id + "_chart") != null) {
                       document.getElementById(id + "_chart").setAttributeNS(null, "display","none");
                   }
               }
               myMapApp.Windows["legend"].setTitleText("Legend");
               if (curLegendRect != null && !myMapApp.Windows["legend"].closed) {
                   curLegendRect.setAttributeNS(null, "stroke-width",1);
                   curLegendRect.setAttributeNS(null, "stroke","dimgray");
               }
             }
        } 
			
	
		function colourMap() {
			if (document.documentElement.suspendRedraw) {
				suspendProcess = document.documentElement.suspendRedraw(20000);
			}
						
			var child = myMapApp.targetLayer.firstChild;
			 
			while(child) {
				
				var targetNode = child;
				if (child.nodeName == "a") {
					targetNode = child.firstChild;
				}
				
				if (targetNode.nodeName == "path") {
					var kpiAttrib = parseInt(targetNode.getAttributeNS(attribNS,myMapApp.curKpi));
			
			
					var targetColor = "#666666";
					
					
					if(targetNode.getAttributeNS(attribNS,myMapApp.curKpi) == "") {
						//alert("FOUND " + targetNode.getAttribute("id"));
						targetColor = null_values_color[myMapApp.curKpi];
					} else if(kpiAttrib < lb_values[myMapApp.curKpi]) {
						targetColor = lb_color[myMapApp.curKpi];
					} else if(kpiAttrib > ub_values[myMapApp.curKpi]) {
						targetColor = ub_color[myMapApp.curKpi];
					} else if(kpiAttrib == ub_values[myMapApp.curKpi]) {
						targetColor = myMapApp.colArray[myMapApp.threshArray.length-2];
					} else  {
						for (var i = 0;i<myMapApp.threshArray.length-1;i++) {
							if (kpiAttrib >= myMapApp.threshArray[i] && kpiAttrib <  myMapApp.threshArray[i+1]) {
								targetColor = myMapApp.colArray[i];
								break;
							} 
						}
					}
					

					
					targetNode.setAttributeNS(null,"fill",targetColor);
					
					if(includeValuesLayer == true) {
					   var text = "";
					   var rounded_value = targetNode.getAttributeNS(attribNS,myMapApp.curKpi);
                   	   var value_string = rounded_value.toString();
		   			   var decimal_location = value_string.indexOf(".");		
		   			   if (decimal_location != -1) {
		   			   		//alert(value_string + " - " + parseFloat(value_string) + " - " + round_decimals(parseFloat(value_string), 2) );
                   	   		var value_float = round_decimals( parseFloat(value_string), 2 );
                   	   		text = value_float.toString();
                   	   } else {                       	
                       		text = targetNode.getAttributeNS(attribNS,myMapApp.curKpi);
                  	   }
						var valueLabel = document.getElementById("label_" + targetNode.getAttributeNS(null, "id"));					
						if(valueLabel != null) {
							valueLabel.firstChild.nodeValue = text;
						}
					}
				}
				
				child = child.nextSibling;
			}
			
			myMapApp.loadStatus.setAttributeNS(null,"display","none");
			if (document.documentElement.suspendRedraw) {
				document.documentElement.unsuspendRedraw(suspendProcess);
			}
		}
			
	function windowHandling(id,evtType) {
		if (evtType == "minimized") {
			windowPositions[id] = {"x":myMapApp.Windows[id].transX,"y":myMapApp.Windows[id].transY};
			myMapApp.Windows[id].moveable = false;
			y = 720;
			if (id == "navWindow") {
				x = 10;
			}
			if (id == "basiclayer") {
				x = 436;
			}
			if (id == "thematic") {
				x = 223;
			}
			if (id == "legend") {
				x = 862;
			}
			if (id == "detail") {
				x = 649;
			}
			
			myMapApp.Windows[id].moveTo(x,y,false);
		}
		if (evtType == "maximized") {
			myMapApp.Windows[id].moveTo(windowPositions[id].x,windowPositions[id].y,false);
			myMapApp.Windows[id].moveable = true;
		}
	}
			
]]></script>
		
		<defs>
			<!-- Symbols for checkboxes -->
			<symbol id="checkBoxRect" overflow="visible" preserveAspectRatio="xMinYMin meet">
				<rect x="-6" y="-6" width="12" height="12" fill="white" stroke="dimgray" stroke-width="1.5"/>
			</symbol>
			
			<symbol id="checkBoxCross" overflow="visible" fill="none" stroke="dimgray" stroke-width="1" pointer-events="none" preserveAspectRatio="xMidYMid meet">
				<line x1="-5" y1="-5" x2="5" y2="5"/>
				<line x1="-5" y1="5" x2="5" y2="-5"/>
			</symbol>
			<!-- symbols for radio buttons -->
			<symbol id="radioBorder" overflow="visible" preserveAspectRatio="xMidYMid meet">
				<circle fill="white" stroke="dimgray" stroke-width="1.5" cursor="pointer" r="5" cx="0" cy="0"/>
			</symbol>
			<symbol id="radioPoint" overflow="visible" preserveAspectRatio="xMidYMid meet">
				<circle fill="dimgray" r="3" pointer-events="none" cx="0" cy="0"/>
			</symbol>
			<!-- Symbols for Zoom Magnifyer glasses -->
			<symbol id="magnifyerFull" overflow="visible" preserveAspectRatio="xMidYMid meet">
				<text y="7.5" font-family="Arial,Helvetica" fill="dimgray" font-size="18px" font-weight="bold" text-anchor="middle" pointer-events="none" startOffset="0">F</text>
			</symbol>
			
			<symbol id="infoBut" overflow="visible" preserveAspectRatio="xMidYMid meet">
				<circle fill="none" stroke="dimgray" stroke-width="1.5" r="7.5" cx="0" cy="0"/>
				<text y="5" font-family="Arial,Helvetica" font-size="13px" font-weight="bold" fill="dimgray" text-anchor="middle" pointer-events="none" startOffset="0">i</text>
			</symbol>
			<symbol id="magnifyerManual" overflow="visible" fill="none" stroke="dimgray" stroke-width="1.5" preserveAspectRatio="xMidYMid meet">
				<rect x="-6" y="-6" width="12" height="12" stroke-dasharray="1.5,1.5"/>
				<line x1="-3" y1="0" x2="3" y2="0"/>
				<line x1="0" y1="-3" x2="0" y2="3"/>
				
			</symbol>
			<symbol id="magnifyerZoomIn" overflow="visible" fill="none" stroke="dimgray" stroke-width="2" preserveAspectRatio="xMidYMid meet">
				<line x1="-4" y1="0" x2="4" y2="0"/>
				<line x1="0" y1="-4" x2="0" y2="4"/>
			</symbol>
			<symbol id="magnifyerZoomOut" overflow="visible" preserveAspectRatio="xMidYMid meet">
				<line x1="-4" y1="0" x2="4" y2="0" fill="none" stroke="dimgray" stroke-width="2"/>
			</symbol>
			<!-- hand symbol for panning -->
			
			<symbol id="symbPan" overflow="visible" preserveAspectRatio="xMidYMid meet">
				<path transform="scale(1.2)" fill="none" stroke="dimgray" stroke-width="1" d="M-2 6 C -2.2 2.5 -8.0 -0 -5.7 -1.9 C -4.3 -2.5 -3.3 -0.5 -2.5 0.7 C -3.2 -2.1 -5.5 -5.2 -3.6 -5.8 C -2.1 -6.3 -1.6 -3.6 -1.1 -1.9 C -0.9 -4.2 -1.6 -6.4 -0.2 -6.6 C 1.4 -6.8 0.9 -3 1.1 -1.9 C 1.5 -3.5 1.2 -6.1 2.5 -6.1 C 3.9 -6.1 3.5 -3.2 3.6 -1.6 C 4 -2.9 4.1 -4.3 5.3 -4.4 C 7.3 -3.5 4 2.2 3 6z"/>
			</symbol>
			<!-- Symbol for Arrows -->
			<symbol id="symbArrow" overflow="visible" preserveAspectRatio="xMidYMid meet">
				<polyline fill="none" stroke="dimgray" stroke-width="1" points="-3,-6 3,-6 3,1 5,1 0,7 -5,1 -3,1 -3,-5"/>
			</symbol>
			<symbol id="symbArrowLeft" overflow="visible" preserveAspectRatio="xMidYMid meet">
				<use xlink:href="#symbArrow" transform="rotate(90)"/>
				
			</symbol>
			<symbol id="symbArrowRight" overflow="visible" preserveAspectRatio="xMidYMid meet">
				<use xlink:href="#symbArrow" transform="rotate(-90)"/>
			</symbol>
			<!-- Symbol for Recentering Map -->
			<symbol id="symbRecenter" overflow="visible" preserveAspectRatio="xMidYMid meet">
				<circle fill="dimgray" cx="0" cy="0" r="1" pointer-events="none"/>
				<g fill="none" stroke="dimgray" stroke-width="1.5" pointer-events="none">
					<line x1="-7" y1="-7" x2="-3" y2="-3"/>
					
					<line x1="7" y1="7" x2="3" y2="3"/>
					<line x1="-7" y1="7" x2="-3" y2="3"/>
					<line x1="7" y1="-7" x2="3" y2="-3"/>
				</g>
			</symbol>
			<!-- Symbol for Slider -->
			<symbol id="sliderSymbol" overflow="visible" pointer-events="none" preserveAspectRatio="xMidYMid meet">
				<line x1="0" y1="-5" x2="0" y2="5" fill="none" stroke="dimgray" stroke-width="5"/>
			</symbol>
			
			<!-- Symbol for Dragging if zoomed in far -->
			<symbol id="myDragCrossSymbol" overflow="visible" stroke-width="2000" fill="none" stroke="darkblue" pointer-events="none" preserveAspectRatio="xMidYMid meet">
				<line x1="-7000" y1="0" x2="-2500" y2="0"/>
				<line x1="7000" y1="0" x2="2500" y2="0"/>
				<line x1="0" y1="-3300" x2="0" y2="-7800"/>
				<line x1="0" y1="3300" x2="0" y2="7800"/>
			</symbol>
			<!-- Marker for Extent-Arrows -->
			<marker id="myStartArrow" overflow="visible" orient="auto" preserveAspectRatio="xMidYMid meet">
				
				<polyline fill="dimgray" points="-0.5,0 8,-2 8,2"/>
			</marker>
			<marker id="myEndArrow" overflow="visible" orient="auto" preserveAspectRatio="xMidYMid meet">
				<polyline fill="dimgray" points="0.5,0 -8,-2 -8,2"/>
			</marker>
		<symbol id="maximizeButton" overflow="visible" preserveAspectRatio="xMidYMid meet"><rect x="-5.5" y="-5.5" width="11" height="11" fill="steelblue" stroke="white" stroke-width="2" pointer-events="fill"/></symbol><symbol id="minimizeButton" overflow="visible" preserveAspectRatio="xMidYMid meet"><rect x="-5.5" y="-5.5" width="11" height="11" fill="steelblue" pointer-events="fill"/><line x1="5.5" x2="-5.5" y1="5.5" y2="5.5" stroke="white" stroke-width="2"/></symbol></defs>
		<title>SpagoBI Geo Engine</title>
		
		
		<!-- sfondo del pannello che contiene la mappa 
		<rect x="0" y="0" width="1100" height="722" stroke="none" fill="#e6e6e6"/>
		-->
		
		<rect x="0" y="0" width="1100" height="722" stroke="none" fill="#e6e6e6"/>
		
		<!-- sfondo della mappa -->
		<rect x="4" y="4" width="1092" height="690" fill="white"/>
		
		<!-- Main Map Frame -->
		<svg id="mainMap" x="4" y="4" width="1092" height="690" viewBox="0 0 0 0" 
			xmlns:attrib="http://www.carto.net/attrib" xmlns:xlink="http://www.w3.org/1999/xlink" 
			xmlns="http://www.w3.org/2000/svg" 
			preserveAspectRatio="xMidYMid meet" zoomAndPan="magnify">
			
			<style type="text/css">
				<![CDATA[
				circle {stroke-width:2}
				]]>
			</style>


				
				<g id="mainMapGroup">
		
				<rect id="mapBackgroundRect" x="0" y="0" width="0" height="0" fill="none" stroke="none" pointer-events="fill"/>
			
				
				
				<g id="eventCatcher" stroke-linecap="round" onmouseover="showData(evt)" onmouseout="showData(evt)" fill="white" stroke-linejoin="round"  stroke-width="2000">
				
				<g id="targetMap">
				
				
				
				</g>
				
				<g id="grafici" fill="white" stroke="black" stroke-width="0.2" stroke-linecap="square " stroke-linejoin="miter">	</g>
				<g id="valori" fill="white" stroke="black" stroke-width="0.2" stroke-linecap="square " stroke-linejoin="miter">	</g>
				
				</g>
				</g>
		</svg>

	<!-- cornice della mappa -->
	<rect x="4" y="4" width="1092" height="690" fill="none" stroke="dimgray"/>
		
	<g id="statusColorMap" display="none">
		<rect x="500" y="200" width="160" height="50" fill="#fffce6" fill-opacity="0.8"/>
		<text x="515" y="220" fill="steelblue" font-family="Arial,Helvetica" font-size="14px" startOffset="0">loading Data ...</text>
		<text x="560" y="240" fill="steelblue" font-family="Arial,Helvetica" font-size="14px" startOffset="0">...coloring Map</text>
	</g>
	
	    <!-- this group holds navigation, title and if you like, legend information -->
	    <g>
	        
	        <!-- map impressum and status Bar -->
	        <g text-rendering="optimizeLegibility" font-family="Arial,Helvetica" fill="dimgray" font-size="12px">
	            <!-- text with this id is required to show help texts -->
	            <text id="statusText" x="-745" y="-100" startOffset="0">Statusbar: Mode: Infomode</text>
	        <!--    
	        	<text x="10" y="713" startOffset="0">Map Authors: Engineering Ingegneria Informatica S.p.A.</text>
	        	<text x="1090" y="713" text-anchor="end" startOffset="0">Source: SIT Comune di Genova</text>
	        -->
	        </g>
	    </g>
	    <!-- small reference map, shares the same coordinate system than the main map -->
	    <!-- it is very recommended that the width and height of the nested svg element has the same ratio as the viewBox width and height -->
		
	    <!-- this group holds the zoom slider and buttons -->
	    <g>
	        <!-- empty group where zoomSlider is later appended -->
	        
	        <!-- button for zoom-in, above slider -->
	        
	        <!-- button for zoom-out, below slider -->
	        
	        <!-- info button -->
	        
	        <!-- button for full view (f) -->
	        
	        <!-- button for manual zoom (rectangle) -->
	        
	        <!-- button for manual pan -->
	        
	        <!-- button for redefining map center -->
	        <g id="recenterMap" display="none"><rect x="131" y="164" width="20" height="20" points="132,185 132,165 152,165" fill="rgb(235,235,235)"/>
					<rect x="133" y="166" width="20" height="20" points="132,185 132,165 152,165" fill="dimgray"/>
					<rect x="132" y="165" width="20" height="20" fill="white" cursor="pointer"/>
					<use x="142" y="175" xlink:href="#symbRecenter" pointer-events="none"/>
					<rect x="131" y="164" width="22" height="22" fill="white" fill-opacity="0.5" stroke="none" display="inherit" cursor="default"/></g>
	        <!-- button for backwarding map extent (extent history) -->
	        
	        <!-- button for forwarding map extent (extent history) -->
	        
	        <!-- button for demonstrating highlight feature of the map -->
	        <g id="highlightMap" cursor="pointer"/>		
	    </g>
	 lo
	    
	    <!-- WINDOWS CONTENT -->
	    <g id="Windows">
			
				<!-- Navigation Window -->
				<g id="navWindow" transform="translate(10,537)">
					
					<rect width="210" height="200" fill="none" stroke="dimgray" stroke-width="1.5" display="none"/>
					<rect width="210" height="17" fill="none" stroke="dimgray" stroke-width="1.5" display="none"/>
					
					<g id="windowMainGroupnavWindow">
					<g/>
					
					
						<svg id="referenceMap" x="10" y="8" viewBox="-2471570.4 -1631093.7 4844781 3030131.8" width="190" height="150" 
								 xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" 
								 preserveAspectRatio="xMidYMid meet" zoomAndPan="magnify" cursor="crosshair" display="inherit">
								 
								 <rect x="-2471570.4" y="-1631093.7" width="4844781" height="3030131.8" fill="none" stroke="none" pointer-events="fill"/>
								 <rect fill="none" pointer-events="fill" x="-2471570.4" y="-1631093.7" width="4844781" height="3030131.8"/>
								
								<!-- here you can place any graphical elements for your reference/overview map -->
								<use xlink:href="#mainMapGroup" fill="white" stroke-width="2419.9" stroke-linecap="round" stroke-linejoin="round" pointer-events="none"/>
								<rect x="-2471570.4" y="-1631093.7" width="4844781" height="3030131.8" fill="dimgray" fill-opacity="0.3" pointer-events="none"/>
								<use x="-2471570.4" y="-1631093.7" visibility="hidden" xlink:href="#myDragCrossSymbol"/>
								
								<g visibility="hidden" stroke="crimson" stroke-width="55689.5" pointer-events="none">
									<line x1="-2471570" x2="2373210" y1="-116028" y2="-116028"/>
									<line x1="-49179.9" x2="-49179.9" y1="-1631090" y2="1399040"/>
								</g>
						</svg>
						
						<g id="zoomIn" cursor="pointer" display="inherit">
						</g>
						
						<g id="mapZoomSlider" display="inherit">
						</g>
						
						<g id="zoomOut" cursor="pointer" display="inherit">
						</g>
						
						<g id="zoomFull" cursor="pointer" display="inherit">
						</g>
						
						<g id="zoomManual" cursor="pointer" display="inherit">
						</g>
						
						<g id="panManual" cursor="pointer" display="inherit">
						</g>
						
						<g id="infoButton" cursor="pointer" display="inherit">
						</g>
						
						
						<g id="backwardExtent" cursor="pointer" display="inherit" />
						
						<g id="forwardExtent" cursor="pointer" display="inherit">
						</g>
						
					</g>
				</g>
					
				<!-- Layers Window -->
				<g id="basiclayer" transform="translate(436,720)">
					<rect width="210" height="200" fill="none" stroke="dimgray" stroke-width="1.5" display="none"/>
					<rect width="210" height="17" fill="none" stroke="dimgray" stroke-width="1.5" display="none"/>
					
						<g id="windowMainGroupbasiclayer" display="none">
						<g/>
						
						<g id="checkBoxes" display="inherit">
							
						</g>
						
						<g id="linkRadioGroup" display="inherit">
						<rect width="210" height="17" fill="steelblue" stroke="dimgray" stroke-width="1" id="titleBarthematic" cursor="pointer"/>
						
						</g>					
					</g>
							
				</g>
				
				<!-- Thematics Window -->
				<g id="thematic" transform="translate(223,537)"><rect width="210" height="200" fill="none" stroke="dimgray" stroke-width="1.5" display="none"/>
					<rect width="210" height="17" fill="none" stroke="dimgray" stroke-width="1.5" display="none"/>
					
					<g id="windowMainGroupthematic" display="inherit">					
						
						<g id="radioButtons" display="inherit">
							
						</g>					
					</g>
				</g>
				
				
				
				
				<!-- Detail Window -->
				<g id="detail" transform="translate(649,720)">
					<rect width="441" height="200" fill="none" stroke="dimgray" stroke-width="1.5" display="none"/>
					<rect width="441" height="17" fill="none" stroke="dimgray" stroke-width="1.5" display="none"/>
						
					<g id="windowMainGroupdetail" display="inherit">
						
						<!--
						<rect width="441" height="200" fill="#fffce6" stroke="dimgray" stroke-width="1"/>
						<g/>
						-->
						
						<g id="detailTabGroup" display="none">
							<g> 
									<g>            
											<g id="detailTabGroup__0_content">
													<g id="dynamText" class="allText normalText">
														<!--
														<text id="infopanel1" x="20" y="50" fill="dimgray" font-family="Arial,Helvetica" font-size="14px" startOffset="0">Iscritti </text>
														<text id="infopanel2" x="20" y="75" fill="dimgray" font-family="Arial,Helvetica" font-size="14px" startOffset="0">Asili </text>
														<text id="infopanel3" x="20" y="100" fill="dimgray" font-family="Arial,Helvetica" font-size="14px" startOffset="0">Docenti </text>
													-->
													</g>
											</g>
									</g>									
											 
									<g>                
											<g id="detailTabGroup__1_content">
											
											<!--
											<g id="chart" transform="translate(50 35)" font-size="8" shape-rendering="geometricPrecision" display="none">
													<rect id="chartBox" x="0" y="0" width="100" height="100" fill="none" stroke="gray" stroke-width=".2"/>
											</g>
											-->
											</g>
									</g>
							</g>
						</g>
						
					
						
					</g>
				</g>
				
				
				<g id="colourPickerPanel_1" display="none">
					<g id="colourPickerBox_1" />
					
					<g id="colourPickerButtons">
						<rect x="300" y="420" width="300" height="35" fill="white" stroke="dimgray" stroke-width="1"/>
						<g id="colourPickerApplay" />
						<g id="colourPickerOk" />
						<g id="colourPickerCancel" />
					</g>
				</g>
						
				<!-- Legend Window -->
				<g id="legend" transform="translate(649,720)">
					<rect width="441" height="200" fill="none" stroke="dimgray" stroke-width="1.5" display="none"/>
					<rect width="441" height="17" fill="none" stroke="dimgray" stroke-width="1.5" display="none"/>
						
					<g id="windowMainGrouplegend" display="none">
						
						
							
						<g id="coulourboxes" display="inherit">
							
						
						</g>
					</g>
				
					
				</g>
		
		</g>
	
	
		 
		
		<!-- tab content -->
    
	
		<!-- show data -->
	
		
	
		<svg id="logo" x="1040" y="-1" width="500" height="200" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" zoomAndPan="magnify">
			<g transform="scale(0.3)">
			
			</g>
		</svg>
	</svg>
